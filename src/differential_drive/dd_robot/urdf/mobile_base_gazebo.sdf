<?xml version="1.0" ?>
<!--USE THIS FILE, IF IT IS REQUIRED. URDF/XACRO FILE IS SUFFICIENT IN ORDER TO VISULAIZE IN GAZEBO-->
<!--CHECK THE PLACEMNET OF CAMERA AND LIDAR. THESE TWO ARE MISPLACED-->
<!--COLOR OF base_link IS MORE DARKER COMPARED TO IN RVIZ. ADJUST THE MATERIAL VALUES OF 'base_link'-->
<!--THE ROBOT IS SLIDING, WHEN APPLYING BRAKE. TRY TO MODIFY THAT AS WELL-->
<sdf version="1.8">
    <model name ="dd_robot">
    
      <pose>0 0 0.5 0 0 0</pose>
      <link name ="base_footprint"/>

      <link name ="base_link">
        <inertial>
            <pose>0.0 0.0 0.10 0.0 0.0 0.0</pose>
            <inertia>
                <ixx>0.0833333</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.1666667</iyy>
                <iyz>0.0</iyz>
                <izz>0.2166667</izz>
            </inertia>
            <mass>5.0</mass>
        </inertial>

        <collision name ="base_collision">
            <pose>0.0 0.0 0.105 0.0 0.0 0.0</pose>
            <geometry>
                <box>
                    <size>0.60 0.40 0.20</size>
                </box>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>1.0</mu>
                        <mu2>1.0</mu2>
                    </ode>
                </friction>
                <contact>
                    <ode>
                        <soft_cfm>1e-9</soft_cfm>
                        <soft_erp>0.2</soft_erp>
                        <kp>2e6</kp>
                        <kd>50</kd>
                        <max_vel>0.2</max_vel>
                        <min_depth>0.001</min_depth>
                    </ode>
                </contact>
                <bullet>
                    <split_impulse>1</split_impulse>
                    <split_impulse_penetration_threshold>-0.01</split_impulse_penetration_threshold>
                    <soft_cfm>0.0</soft_cfm>
                    <soft_erp>0.2</soft_erp>
                    <kp>2e6</kp>
                    <kd>50</kd>
                </bullet>
            </surface>
        </collision>
        <visual name ="base_visual">
            <pose>0.0 0.0 0.105 0.0 0.0 0.0</pose>
            <geometry>
                <box>
                    <size>0.60 0.40 0.20</size>
                </box>
            </geometry>
            <material>
                <ambient>0.0 0.6 0.0 1.0</ambient>
                <diffuse> 0.0 0.1 0.0 1.0</diffuse>
            </material>
        </visual>
      </link>

      <link name="right_wheel_link">
        <pose>-0.15 -0.225 0 0.0 0.0 0.0</pose>
        <inertial>
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <inertia>
                <ixx>0.002708</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.002708</iyy>
                <iyz>0.0</iyz>
                <izz>0.005000</izz>
            </inertia>
            <mass>1.0</mass>
        </inertial>
        <collision name ="right_wheel_collision">
            <pose>0.0 0.0 0.0 1.5708 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05</length>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>0.1</mu>
                        <mu2>3.0</mu2>
                        <fdir1>0 0 0</fdir1>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
                <contact>
                    <ode>
                        <soft_cfm>0</soft_cfm>
                        <soft_erp>0.2</soft_erp>
                        <kp>1e+5</kp>
                        <kd>1</kd>
                        <max_vel>0.01</max_vel>
                        <min_depth>0.001</min_depth>
                    </ode>
                </contact>
                <bullet>
                    <split_impulse>1</split_impulse>
                    <split_impulse_penetration_threshold>-0.01</split_impulse_penetration_threshold>
                    <soft_cfm>0.0</soft_cfm>
                    <soft_erp>0.2</soft_erp>
                    <kp>2e6</kp>
                    <kd>50</kd>
                </bullet>
            </surface>
        </collision>
        <visual name ="right_wheel_visual">
            <pose>0.0 0.0 0.0 1.5708 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05</length>
                </cylinder>
            </geometry>
            <material>
                <ambient>1.0 1.0 0.0 1.0</ambient>
                <diffuse>1.0 1.0 0.0 1.0</diffuse>
            </material>
        </visual>
      </link>

      <link name="left_wheel_link">
        <pose>-0.15 0.225 0.0 0.0 0.0 0.0</pose>
        <inertial>
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <inertia>
                <ixx>0.002708</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.002708</iyy>
                <iyz>0.0</iyz>
                <izz>0.005000</izz>
            </inertia>
            <mass>1.0</mass> 
        </inertial>
        <collision name ="left_wheel_collision">
            <pose>0.0 0.0 0.0 1.5708 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05</length>
                </cylinder>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>0.1</mu>
                        <mu2>3.0</mu2>
                        <fdir1>0 0 0</fdir1>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
                <contact>
                    <ode>
                        <soft_cfm>0</soft_cfm>
                        <soft_erp>0.2</soft_erp>
                        <kp>1e+5</kp>
                        <kd>1</kd>
                        <max_vel>0.01</max_vel>
                        <min_depth>0.001</min_depth>

                    </ode>
                </contact>
                <bullet>
                    <split_impulse>1</split_impulse>
                    <split_impulse_penetration_threshold>-0.01</split_impulse_penetration_threshold>
                    <soft_cfm>0.0</soft_cfm>
                    <soft_erp>0.2</soft_erp>
                    <kp>2e6</kp>
                    <kd>50</kd>
                </bullet>
            </surface>
        </collision>
        <visual name ="left_wheel_visual">
            <pose>0.0 0.0 0.0 1.5708 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05</length>
                </cylinder>
            </geometry>
            <material>
                <ambient>1.0 1.0 0.0 1.0</ambient>
                <diffuse>1.0 1.0 0.0 1.0</diffuse>
            </material>
        </visual>
      </link>

      <link name ="caster_wheel_link">
        <pose>0.20 0.0 -0.05 0.0 0.0 0.0 </pose>
        <inertial>
            <mass>0.5</mass>
            <inertia>
                <ixx>0.0005</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.0005</iyy>
                <iyz>0.0</iyz>
                <izz>0.0005</izz>
            </inertia>
        </inertial>
        <collision name ="caster_wheel_collision">
            <geometry>
                <sphere>
                    <radius>0.0500</radius>
                </sphere>
            </geometry>
            <surface>
                <friction>
                    <ode>
                        <mu>0.000002</mu>
                        <mu2>0.000002</mu2>
                        <fdir1>0 0 0</fdir1>
                        <slip1>0.0</slip1>
                        <slip2>0.0</slip2>
                    </ode>
                </friction>
                <contact>
                    <ode>
                        <soft_cfm>0</soft_cfm>
                        <soft_erp>0.2</soft_erp>
                        <kp>1e+5</kp>
                        <kd>1</kd>
                        <max_vel>0.01</max_vel>
                        <min_depth>0.001</min_depth>
                    </ode>
                </contact>
                <bullet>
                    <split_impulse>1</split_impulse>
                    <split_impulse_penetration_threshold>-0.01</split_impulse_penetration_threshold>
                    <soft_cfm>0.0</soft_cfm>
                    <soft_erp>0.2</soft_erp>
                    <kp>2e6</kp>
                    <kd>50</kd>
                </bullet>
            </surface>
        </collision>
        <visual name ="caster_wheel_visual">
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <geometry>
                <sphere>
                    <radius>0.0500</radius>
                </sphere>
            </geometry>
            <material>
                <ambient>1.0 1.0 0.0 1.0</ambient>
                <diffuse>1.0 1.0 0.0 1.0</diffuse>
            </material>
        </visual>
      </link>

      <!--IMU-->
      <link name="imu_link">
           <sensor type="imu" name="imu_sensor">
           <topic>/imu</topic>
           <gz_frame_id>imu_link</gz_frame_id>
           <always_on>1</always_on>
           <update_rate>250</update_rate>
           <visualize>true</visualize>
           <imu>
              <angular_velocity>
                 <x><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></x>
                 <y><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></y>
                 <z><noise type="gaussian"><mean>0.0</mean><stddev>0.0002</stddev></noise></z>
              </angular_velocity>
              <linear_acceleration>
                  <x><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></x>
                  <y><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></y>
                  <z><noise type="gaussian"><mean>0.0</mean><stddev>0.017</stddev></noise></z>
              </linear_acceleration>
           </imu>
              <plugin filename="gz-sim-imu-system" name="gz::sim::systems::Imu"> 
                <initial_orientation_as_reference>false</initial_orientation_as_reference>
              </plugin>
          </sensor>
        </link>
      <!--CAMERA-->
      <link name="camera_link">
        <inertial>
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <inertia>
                <ixx>0.001</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.001</iyy>
                <iyz>0.0</iyz>
                <izz>0.001</izz>
            </inertia>
            <mass>0.035</mass>
        </inertial>
        
        <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
        <sensor name="depth_camera" type="rgbd_camera">
            <always_on>true</always_on>
            <visualize>true</visualize>
            <update_rate>20</update_rate>
            <topic>depth_camera</topic>
            <gz_frame_id>camera_link</gz_frame_id>
            <camera>
                <horizontal_fov>1.047198</horizontal_fov>
                <image>
                    <width>640</width>
                    <height>480</height>
                    <format>R8G8B8</format>
                </image>
                <clip>
                    <near>0.05</near>
                    <far>3</far>
                </clip>
            </camera>
            <!--ros>
              <remapping>~/image:=/camera/color/image_raw</remapping>
              <remapping>~/camera_info:=/camera/color/camera_info</remapping>
              <remapping>~/depth_image:=/camera/depth/image_raw</remapping>
              <remapping>~/points:=/camera/depth/points</remapping> 
            </ros>
            <output_type>sensor_msgs/Image</output_type-->
        </sensor>
      </link>
      <!--LIDAR-->
      <link name="lidar_link">
        <inertial>
            <pose>0.2 0.0 0.45 0.0 0.0 0.0</pose>
            <inertia>
                <ixx>0.003333</ixx>
                <ixy>0.0</ixy>
                <ixz>0.0</ixz>
                <iyy>0.003333</iyy>
                <iyz>0.0</iyz>
                <izz>0.005000</izz>
            </inertia>
            <mass>1.0</mass>
        </inertial>
        <collision name="lidar_collision">
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05</length>
                </cylinder>
            </geometry>
        </collision>
        <visual name="lidar_visual">
            <pose>0.0 0.0 0.0 0.0 0.0 0.0</pose>
            <geometry>
                <cylinder>
                    <radius>0.1</radius>
                    <length>0.05
                    </length>
                </cylinder>
            </geometry>
            <material>
                    <ambient>1.0 1.0 0.0 1.0</ambient>
                    <diffuse>1.0 1.0 0.0 1.0</diffuse>
            </material>
        </visual>
        <sensor name="lidar" type="gpu_lidar">
           <always_on>1</always_on>
           <topic>lidar_points</topic>
           <visualize>true</visualize>
           <gz_frame_id>lidar_link</gz_frame_id>
           <update_rate>10.0</update_rate>
           <lidar>
               <scan>
                 <horizontal>
                   <samples>480</samples>
                   <resolution>1</resolution>
                   <min_angle>-3.14159265</min_angle>
                   <max_angle>3.14159265</max_angle>
                 </horizontal>
               </scan>
               <range>
                 <min>0.5</min>
                 <max>131.0</max>
                 <resolution>0.001</resolution>
               </range>
               <noise>
                 <type>gaussian</type>
                 <mean>0.0</mean>
                 <stddev>0.08</stddev>
               </noise>
               <frame_id>lidar_link</frame_id>
           </lidar>
        </sensor>
      </link>

      <!--BASE JOINT-->
      <joint name = "base_joint" type ="fixed">
        <parent>base_footprint</parent>
        <child>base_link</child>
        <pose>0.0 0.0 0.10 0.0 0.0 0.0</pose>
      </joint>
      <!--RIGHT WHEEL JOINT-->
      <joint name="right_wheel_joint" type="revolute">
        <parent>base_link</parent>
        <child>right_wheel_link</child>
        <pose>0 0 0 0 0 0</pose>
        <axis>
            <xyz>0 1 0</xyz>
            <limit>
                <effort>50000</effort>
                <velocity>10</velocity>
            </limit>
        </axis>
     
        <!--limit effort ="50000" velocity ="10" />
        <dynamics damping ="1.0" friction="1.0"/-->
      </joint>
      <!--LEFT WHEEL JOINT-->
      <joint name="left_wheel_joint" type="revolute">
        <parent>base_link</parent>
        <child>left_wheel_link</child>
        <pose>0 0 0 0 0 0</pose>
        <axis>
            <xyz>0 1 0</xyz>
            <limit>
                <effort>50000</effort>
                <velocity>10</velocity>
            </limit>
        </axis>
     
        <!--limit effort ="50000" velocity ="10" />
        <dynamics damping ="1.0" friction="1.0"/-->
      </joint>
      <!--CASTER WHEEL JOINT-->
      <joint name="base_caster_wheel_joint" type="fixed">
        <parent>base_link</parent>
        <child>caster_wheel_link</child>
        <pose>0 0 0 0 0 0</pose>
      </joint>
      <!--IMU-->
      <joint name="imu_joint" type="fixed">
       <parent>base_link</parent>
       <child>imu_link</child>
       <pose>0.0 0.0 0.10 0.0 0.0 0.0</pose>
      </joint>
      <!--CAMERA-->
      <link name="camera_depth_frame"/>
      <joint name="camera_joint" type="fixed">
        <parent>base_link</parent>
        <child>camera_link</child>
        <pose>0.30 0.0 0.10 0.0 0.0 0.0</pose>
      </joint>
      <joint name="camera_depth_joint" type="fixed">
         <parent>camera_link</parent>
         <child>camera_depth_frame</child>
         <pose>0.0 0.0 0.0 -1.57079632679 0 -1.57079632679</pose>
      </joint>
      <!--LIDAR-->
      <joint name="base_lidar_joint" type="fixed">
        <parent>base_link</parent>
        <child>lidar_link</child>
        <pose>0.15 0.0 0.225 0.0 0.0 0.0</pose>
      </joint>
      <!--PLUGINS-->
      <plugin
            filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">

            <left_joint>left_wheel_joint</left_joint>
            <right_joint>right_wheel_joint</right_joint>
            <wheel_separation>0.45</wheel_separation>
            <wheel_radius>0.1</wheel_radius> 
            <odom_topic>odom</odom_topic>
            <frame_id>odom</frame_id>
            <child_frame_id>base_footprint</child_frame_id>
            <odom_publish_frequency>30.0</odom_publish_frequency>
            <publish_tf>true</publish_tf>
            <tf_topic>/tf</tf_topic>
      </plugin>

      <plugin
            filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
            
            <joint_name>right_wheel_joint</joint_name>
            <joint_name>left_wheel_joint</joint_name>
      </plugin>
      
      <plugin filename="gz-sim-sensors-system" name="gz::sim::systems::Sensors">
        <render_engine>ogre2</render_engine>
      </plugin>

    </model>

</sdf>